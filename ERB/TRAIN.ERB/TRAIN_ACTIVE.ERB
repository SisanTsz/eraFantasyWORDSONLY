@TRAIN_ACTIVE ;主动战斗
    #DIM LCOUNT
    #DIM CNUM
    #DIM TRAINNO
    #DIMS PRE
    #DIMS PRE_1
    #DIMS PRE_2
    STR:TRAINACTIVECODE1 = 1.1.2
    FOR LCOUNT, 1, 101
        PRE = TRAINACTIVECODE%TOSTR(LCOUNT)%
        IF STR:PRE != ""
            CALL TRAIN_ACTIVE_DECODE(STR:PRE)
        ENDIF
    NEXT

@TRAIN_ACTIVE_DECODE(ARGS) ;把指令列表解码, 0=主角, 1= 指令, 2= 对象
    #DIM WNUM
    #DIM LNUM
    #DIM TRAINER
    #DIM TRAINEE
    #DIM TRAINN
    #DIM WNO = 0
    #DIM LCOUNT
    #DIMS PRE 
    #DIMS PRE_1
    SPLIT ARGS, ".", LOCALS
    TRAINER = TOINT(LOCALS:0)
    TRAINEE = TOINT(LOCALS:2)
    TRAINN = TOINT(LOCALS:1)
    TRYCALLFORM TRAIN_ACTIVE_DECODE_AFTER(TRAINN,TRAINER,TRAINEE)
    TRYCALLFORM TRAIN_PUSH_KOJO_{TRAINER}_{TRAINN}a
    TRYCALLFORM TRAIN_PUSH_KOJO_{TRAINEE}_{TRAINN}b

@TRAIN_ACTIVE_DECODE_AFTER(ARG,ARG:1,ARG:2)
    #DIM LCOUNT
    #DIM TRAINER
    #DIM TRAINEE
    #DIMS PRE 
    #DIMS PRE_1
    #DIMS TBODY
    #DIMS MBODY
    #DIM SOURCEDATA
    #DIM LCOUNT_1
    SOURCEDATA = 0
    TRAINER = ARG:1
    TRAINEE = ARG:2
    PRE = TRAINACTIVEVALUE%TOSTR(ARG)%a
    SPLIT STR:PRE, ",", LOCALS
    MBODY = TOSTR(LOCALS:1)
    IF TOSTR(LOCALS:2) != 0
        TBODY = TOSTR(LOCALS:2)
    ENDIF
    FOR LCOUNT, 1, 11
        PRE_1 = %STRNAME:LCOUNT%快乐
        SOURCEDATA = TOINT(LOCALS:(LCOUNT+3))
        FOR LCOUNT_1, 0, ABL:(%MBODY%技巧)
            TIMES, SOURCEDATA, 1.2
        NEXT
        FOR LCOUNT_1, 0, ABL:(%MBODY%感度)
            TIMES, SOURCEDATA, 1.2
        NEXT
        SOURCE:TRAINER:PRE_1 += SOURCEDATA
    NEXT
    FOR LCOUNT, 20, 34
        PRE_1 = SOURCENAME:LCOUNT
        SOURCEDATA = TOINT(LOCALS:(LCOUNT-6))
        FOR LCOUNT_1, 0, ABL:(%MBODY%技巧)
            TIMES, SOURCEDATA, 1.2
        NEXT
        FOR LCOUNT_1, 0, ABL:(%MBODY%感度)
            TIMES, SOURCEDATA, 1.2
        NEXT
        SOURCE:TRAINER:PRE_1 += SOURCEDATA
    NEXT
    FOR LCOUNT, 35, 40
        PRE_1 = SOURCENAME:LCOUNT
        SOURCEDATA = TOINT(LOCALS:(LCOUNT-8))
        FOR LCOUNT_1, 0, ABL:(%MBODY%技巧)
            TIMES, SOURCEDATA, 1.2
        NEXT
        FOR LCOUNT_1, 0, ABL:(%MBODY%感度)
            TIMES, SOURCEDATA, 1.2
        NEXT
        SOURCE:TRAINER:PRE_1 += SOURCEDATA
    NEXT
    PRE_1 = 反抗
    SOURCE:TRAINER:反抗 += TOINT(LOCALS:32)
    PRE_1 = 体力消耗
    SOURCE:TRAINER:体力消耗 += TOINT(LOCALS:33)
    ;对象
    PRE = TRAINACTIVEVALUE%TOSTR(ARG)%b
    SPLIT STR:PRE, ",", LOCALS
    MBODY = TOSTR(LOCALS:1)
    IF TOSTR(LOCALS:2) != 0
        TBODY = TOSTR(LOCALS:2)
    ENDIF
    FOR LCOUNT, 1, 11
        PRE_1 = %STRNAME:LCOUNT%快乐
        SOURCEDATA = TOINT(LOCALS:(LCOUNT+3))
        FOR LCOUNT_1, 0, ABL:(%MBODY%技巧)
            TIMES, SOURCEDATA, 1.2
        NEXT
        FOR LCOUNT_1, 0, ABL:(%MBODY%感度)
            TIMES, SOURCEDATA, 1.2
        NEXT
        SOURCE:TRAINEE:PRE_1 += SOURCEDATA
    NEXT
    FOR LCOUNT, 20, 34
        PRE_1 = SOURCENAME:LCOUNT
        SOURCEDATA = TOINT(LOCALS:(LCOUNT-6))
        FOR LCOUNT_1, 0, ABL:(%MBODY%技巧)
            TIMES, SOURCEDATA, 1.2
        NEXT
        FOR LCOUNT_1, 0, ABL:(%MBODY%感度)
            TIMES, SOURCEDATA, 1.2
        NEXT
        SOURCE:TRAINEE:PRE_1 += SOURCEDATA
    NEXT
    FOR LCOUNT, 35, 40
        PRE_1 = SOURCENAME:LCOUNT
        SOURCEDATA = TOINT(LOCALS:(LCOUNT-8))
        FOR LCOUNT_1, 0, ABL:(%MBODY%技巧)
            TIMES, SOURCEDATA, 1.2
        NEXT
        FOR LCOUNT_1, 0, ABL:(%MBODY%感度)
            TIMES, SOURCEDATA, 1.2
        NEXT
        SOURCE:TRAINEE:PRE_1 += SOURCEDATA
    NEXT
    PRE_1 = 反抗
    SOURCE:TRAINEE:反抗 += TOINT(LOCALS:32)
    PRE_1 = 体力消耗
    SOURCE:TRAINEE:体力消耗 += TOINT(LOCALS:33)





@TRAIN_ACTIVE_CODE_PUSH(ARG:1, ARG:2, ARG:3) ;新增指令列表
    #DIM WNUM
    #DIM LNUM
    #DIM WNO = 0
    #DIM LCOUNT
    #DIMS PRE 
    #DIMS PRE_1
    #DIMS CODE
    #DIM INITIATED
    WNO = 0
    
    LNUM = 15
    IF ARG:1 != 0 && ARG:2 != 0 && ARG:3 != 0
        CODE = %TOSTR(ARG:1)%.%TOSTR(ARG:2)%.%TOSTR(ARG:3)%
        PRE = TRAINACTIVECODE%TOSTR(TRAIN_ACTIVE_CODE_LAST())%
        STR:PRE = %CODE%
    ENDIF
    ;进行列表刷新(消除空行)
    $LOOP_1
    INITIATED = 0
    FOR LCOUNT, 1, 100
        PRE = TRAINACTIVECODE%TOSTR(LCOUNT)%
        PRE_1 = TRAINACTIVECODE%TOSTR(LCOUNT+1)%
        IF STR:PRE == ""
            STR:RPE == STR:RPE_1
            INITIATED = 1
        ENDIF
    NEXT
    SIF INITIATED == 1
        GOTO LOOP_1

@TRAIN_ACTIVE_CODE_LAST
    #FUNCTIONS
    #DIM LCOUNT 
    #DIM NUM
    #DIMS PRE
    NUM = 0
    FOR LCOUNT, 100, 0, -1
        PRE = TRAINACTIVECODE%TOSTR(LCOUNT)%
        IF STR:PRE != ""
            NUM = LCOUNT
            BREAK
        ENDIF
    NEXT
    RETURNF NUM

@TRAIN_ACTIVE_STOP(ARG)
    #DIM LCOUNT
    #DIMS PRE
    #DIMS PRE_1
    FOR LCOUNT, 1, 101
        PRE = TRAINACTIVECODE%TOSTR(LCOUNT)%
        SPLIT STR:PRE , ".", LOCALS
        IF LOCALS:0 == ARG
            STR:PRE = ""
        ENDIF
        IF LOCALS:2 == ARG 
            STR:PRE = ""
        ENDIF
    NEXT
    CALL TRAIN_ACTIVE_CODE_PUSH
